<?xml version="1.0"?>
<!--
  Created by fwienber on 23.04.2016.
-->
<Panel xmlns:fx="http://ns.adobe.com/mxml/2009"
       xmlns="exml:ext.config"
       cls="preview"
       scrollable="true"
       border="true">
  <fx:Script><![CDATA[
    import ext.data.Model;

    private static const TPL:String = '<div class="post-data">' +
            '<span class="post-date">{pubDate:date("M j, Y, g:i a")}</span>' +
            '<h3 class="post-title">{title}</h3>' +
            '<h4 class="post-author">by {author:defaultValue("Unknown")}</h4>' +
            '</div>' +
            '<div class="post-body">{content:stripScripts}</div>';

    private var config:FeedPost;

    public native function FeedPost(config:FeedPost = null);

    private var active:Model;
    /**
     * Set the active post.
     * @param rec The record
     */
    public function setActive(rec:Model):void {
      var gotoButton:Button = Button(this.down('button[text=Go to post]'));
      active = rec;
      update(rec.data);
      if (rec.isInstance) {
        gotoButton.setHref(String(rec.get('link')));
      }
    }

    /**
     * Navigate to the active post in a new window.
     */
    private function goToPost():void {
      window.open(String(active.get('link')));
    }

    /**
     * Open the post in a new tab.
     */
    private function openTab():void {
      fireEvent('opentab', this, active);
    }
    ]]></fx:Script>

  <fx:Declarations>
    <fx:Boolean id="inTab"/>
  </fx:Declarations>

  <tpl>{TPL}</tpl>
  <dockedItems>
    <Toolbar cls="{config.inTab ? 'x-docked-noborder-top' : ''}">
      <items>
        <Button onClick="openTab()"
                text="View in new tab"
                iconCls="tab-new"
                hidden="{config.inTab}"/>
        <TbSeparator
                hidden="{config.inTab}"/>
        <Button href="#"
                hrefTarget="_blank"
                text="Go to post"
                iconCls="post-go"/>
      </items>
    </Toolbar>
  </dockedItems>
</Panel>
